# sudo

<https://www.sudo.ws/about/intro/>

Работает через плагины, которые могут быть скомпилированы в самом sudo или подключаться, как динамические библиотеки (тогда указывается полный путь).

По умолчанию используется встроенный плагин `sudoers.so`

```
Plugin sudoers_policy sudoers.so
Plugin sudoers_io     sudoers.so
Plugin sudoers_audit  sudoers.so
```

Подробнее

    man sudo.conf

## sudoers

Плагин конфигурации, который встроен в sudo и используется по умолчанию. Настройки хранятся в `/etc/sudoers`. Синтаксис настроек описан в `man sudoers` с помощью формальной системы описания синтаксиса ENBF (используется для описания синтаксиса языков программирования).

Для безопасного редактирования настроек используется обёртка, которая сохраняет изменения только после синтаксической проверки, чтобы случайно не заблокировать себе права в системе

    visudo

Пример директивы

    user1 ALL = NOPASSWD: /usr/bin/kill

Разрешает пользователю `user` на системе с любым hostname (`ALL`) с правами `root` (по умолчанию, так как данная лексема здесь пропущена) без авторизации паролем (`NOPASSWD`) выполнять `/usr/bin/kill`

Синтаксис команды описывается лексемой `User_Spec` со следующим описанием

    User_Spec ::= User_List Host_List '=' Cmnd_Spec_List \
                  (':' Host_List '=' Cmnd_Spec_List)*

EBNF позволяет описать любой синтаксис следующей конструкцией

    лексема ::= описание этой лексемы

В описании лексемы могут использоваться другие лексемы, а также

- `'абвгд123?%@_'` — текстовый элемент — символ или группа символов
- `A B`, `A, B` — элемент A, за которым следует элемент B (конкатенация)
- `A | B` — либо элемент A либо B (выбор)
- `[A]` — элемент A входит или не входит (условное вхождение)
- `{A}` — ноль или более элементов A (повторение)
- `(A B)` — группировка элементов

[Примеры настроек](https://www.sudo.ws/sudoers)

Включить журнал учёта выполняемых через sudo команд

    Defaults logfile=/var/log/sudolog

## Команда sudo

Пример

    sudo -u www-data rm -rf /var/www/site1/cache

Опции

- `-l` - отобразить разрешённые для текущего пользователя команды
- `-i` - запустить shell со специфичными для login действиями (применение настроек профиля)
- `-s` - запустить shell (запуск оболочки выглядит неинформативно в логах, в отличии от отдельных команд)
- `-u user1` - использовать конкретного пользователя
- `-e` - безопасное редактирование файла

